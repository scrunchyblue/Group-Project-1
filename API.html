<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Group Project Map</title>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <style>
    #map {
        width: 50%;
        height: 450px;
    }
    </style>
</head>
<body>
    <form>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="inputName">Name</label>
            <input type="text" class="form-control" id="inputName">
          </div>
          <div class="form-group col-md-6">
            <label for="inputPhoneNumber">Phone Number</label>
            <input type="text" class="form-control" id="inputPhoneNumber">
          </div>
        </div>
        <div class="form-group">
          <label for="inputAddress">Address</label>
          <input type="text" class="form-control" id="inputAddress" placeholder="1234 Main St">
        </div>
        <div class="form-group">
          <label for="inputAddress2">Address 2</label>
          <input type="text" class="form-control" id="inputAddress2" placeholder="Apartment, studio, or floor">
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="inputCity">City</label>
            <input type="text" class="form-control" id="inputCity">
          </div>
          <div class="form-group col-md-4">
            <label for="inputState">State</label>
            <input id="inputState" class="form-control" type="text">
          </div>
          <div class="form-group col-md-2">
            <label for="inputZip">Zip</label>
            <input type="text" class="form-control" id="inputZip">
          </div>
        </div>
        <button type="submit" class="btn btn-primary" id="submitButton">Sign in</button>
      </form>
    <br>
    <br>
    <div id="map"></div>

    <div id="theAddress"></div>


    
    <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0rdSnRWTkL1PyhoHgsMoYfs8GhAJbJnw&callback=initMap"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script>


    var personalAPIKey = "AIzaSyA0rdSnRWTkL1PyhoHgsMoYfs8GhAJbJnw";
    var address = "1600+Amphitheatre+Parkway,+Mountain+View,+CA";

    var url = "https://maps.googleapis.com/maps/api/geocode/json?address=" + address + "&key=" + personalAPIKey;

    


    $("#submitButton").on("click", function(event){
        event.preventDefault();

        var name = $("#inputName").val();
        var phoneNumber = $("#inputPhoneNumber").val();
        var firstAddress = $("#inputAddress").val();
        var secondAddress = $("#inputAddress2").val();
        var cityofAddress = $("#inputCity").val();
        var stateofAddress = $("#inputState").val();
        var zipCodeofAddress = $("#inputZip").val();

        var user = {

            name : name,
            phoneNumber : phoneNumber,
            address1: firstAddress,
            address2: secondAddress,
            city: cityofAddress,
            state: stateofAddress,
            zip: zipCodeofAddress
            
        }

        console.log("user: ", user);

        var arrayWithUserInfo = [];

        var userInfo = JSON.parse(localStorage.getItem("user"));

        arrayWithUserInfo = [userInfo];
        arrayWithUserInfo.push(user);

        localStorage.setItem("user", JSON.stringify(arrayWithUserInfo));

        console.log("local storage: ", JSON.stringify(arrayWithUserInfo));
        console.log("var userInfo ", userInfo);


        

        var addingAddresstogether = secondAddress === "" ? `${firstAddress} ${cityofAddress} ${stateofAddress} ${zipCodeofAddress}` : `${firstAddress} ${secondAddress} ${cityofAddress} ${stateofAddress} ${zipCodeofAddress}`;
        console.log("full address: ", addingAddresstogether);


        $("#theAddress").append(addingAddresstogether);

        
        var ourQueryURL = "https://maps.googleapis.com/maps/api/geocode/json?address=" + addingAddresstogether + "&key=" + personalAPIKey;

        $.ajax({
            url: ourQueryURL,
            method: "GET"
        }).then(function(response){
            if (response.status === "OK"){
            var latitude = response.results[0].geometry.location.lat;
            var longitude = response.results[0].geometry.location.lng;
            console.log(response);
    
        initMap(latitude, longitude);
            }
            else {
                alert("ENTER CORRECT ADDRESS");
            }
        
    
        })
    })


    function initMap(lat, long){

        var arr = [];
        var  saguaro = {lat: lat, lng: long};

        var map = new google.maps.Map(
            document.getElementById("map"),
            {zoom: 16, center: saguaro}
        );

        var icon = {
            url: "https://i.pinimg.com/originals/40/d7/be/40d7bec2768bc8cfa69f6d8ed4f85c89.png", 
            scaledSize: new google.maps.Size(width= 27, height=27), 
            origin: new google.maps.Point(0,0), 
            anchor: new google.maps.Point(0, 0) 
        }
    
        var marker = new google.maps.Marker({
            position: saguaro,
            map:map,
            icon:icon,
            animation: google.maps.Animation.BOUNCE,
        })

        arr.push(marker);
        
    }



</script>
</body>
</html>